<div class="container mt-4">
    <h3 class="text-center">
        <i class="bi bi-book-half me-2"></i>Kikölcsönzött könyvek
    </h3>
    @if ((borrowedBooks$ | async)?.length) {
    <table class="table table-hover align-middle mt-5">
        <thead>
            <tr>
                <th>#</th>
                <th>Cím</th>
                <th>Szerző</th>
                <th>Kölcsönzés kezdete</th>
                <th>Kölcsönzés lejárta</th>
                <th></th>
            </tr>
        </thead>
        <tbody>
            @for (book of (borrowedBooks$ | async) ; track book.id) {
            <tr>
                <td>{{ $index + 1 }}</td>
                <td>{{ book.title }}</td>
                <td>{{ book.author }}</td>
                <td>{{ book.borrowedDate | date: 'yyyy.MM.dd.' }}</td>
                <td>
                    {{ book.expirationDate! | date: 'yyyy.MM.dd.' }}
                    @if (isExpired(book.expirationDate!)) {
                    <span class="badge bg-danger ms-2">Lejárt</span>
                    }
                </td>
                <td>@if (!isExtended(book)) {
                    <button class="btn btn-primary fw-bold me-3" data-bs-toggle="modal" data-bs-target="#renewBook"
                        (click)="openRenewModal(book)">Hosszabítás</button>

                    }@else {
                    <button class="btn btn-outline-success fw--bold me-3 disabled">Meghosszabbítva</button>
                    }
                    <button class="btn btn-outline-danger fw-bold" data-bs-toggle="modal" data-bs-target="#cancelBook"
                        (click)="openCancelModal(book)">Lemondás</button>
                </td>
            </tr>
            }
        </tbody>
    </table>
    }@else {
    <div class="alert alert-light text-center border rounded-3 p-5">
        <i class="bi bi-journal-bookmark fs-1 text-muted"></i>
        <h4 class="mt-3 text-muted">Nincs kikölcsönzöd könyved.</h4>
    </div>
    }
</div>

<div class="modal fade" id="cancelBook" tabindex="-1" aria-labelledby="modal-title" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-md">
        <div class="modal-content border-0 shadow-lg rounded-4">

            <div class="modal-header bg-danger text-white">
                <h5>Biztos le akarja mondani a kölcsönzést?</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            @if (selectedBook) {

            <div class="modal-body text-center">
                <p class="text-muted mt-2">
                    <strong>{{ selectedBook.title }}</strong>
                    <small class="d-block">{{ selectedBook.author }}</small>
                </p>
                <p class="text-muted mt-2">
                    Hátralévő nap(ok): {{ getRemainingDays(selectedBook.expirationDate) }} nap
                </p>
            </div>

            <div class="modal-footer">
                <button class="btn btn-danger" (click)="returnBook(selectedBook.id)" data-bs-dismiss="modal">
                    Igen, lemondom
                </button>
                <button class="btn btn-outline-secondary" data-bs-dismiss="modal">Mégse</button>
            </div>
            }
        </div>
    </div>
</div>

<div class="modal fade" id="renewBook" tabindex="-1" aria-labelledby="modal-title" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-md">
        <div class="modal-content border-0 shadow-lg">

            <div class="modal-header bg-primary text-white">
                <h5>Biztos meghosszabítja a kölcsönzést?</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            @if (selectedBook) {
            <div class="modal-body text-center">
                <p class="text-muted mt-2">
                    <strong>{{selectedBook.title}}</strong>
                    <small class="d-block">{{selectedBook.author}}</small>
                </p>
            </div>

            <div class="modal-footer">
                <button class="btn btn-primary" (click)="renewBook(selectedBook)" data-bs-dismiss="modal">Igen,
                    meghosszabbítom</button>
                <button class="btn btn-outline-secondary" data-bs-dismiss="modal">Mégse</button>
            </div>
            }
        </div>
    </div>
</div>